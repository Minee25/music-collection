<!-- Header -->
<header class="text-center py-8">
  <h1 class="text-4xl md:text-6xl font-bold text-blue-800 mb-4">
    üéµ Music üéµ
  </h1>
  <p class="text-xl text-blue-500 font-medium">‡πÄ‡∏û‡∏•‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏ï‡πá‡∏°‡πÑ‡∏õ‡∏î‡πâ‡∏ß‡∏¢‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå‡πÅ‡∏•‡∏∞‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡∏™‡∏∂‡∏Å</p>
</header>

<!-- Main Content -->
<div class="container mx-auto px-4 py-12">
  <div class="max-w-5xl mx-auto">
    <div class="bg-white rounded-2xl shadow-2xl overflow-hidden">
      <% if (music && music.youtube_id) { %>
        <div class="relative pb-[56.25%] h-0">
          <iframe
            class="absolute top-0 left-0 w-full h-full"
            src="https://www.youtube.com/embed/<%= music.youtube_id %>"
            title="YouTube video player"
            frameborder="0"
            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
            referrerpolicy="strict-origin-when-cross-origin"
            allowfullscreen
            loading="lazy">
          </iframe>
        </div>
      <% } else { %>
        <div class="relative pb-[56.25%] h-0 bg-gray-200 flex items-center justify-center">
          <p class="text-gray-500 text-lg">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠ YouTube</p>
        </div>
      <% } %>
    
      <div class="p-6">
        <% if (music) { %>
          <h2 class="text-lg sm:text-2xl font-semibold text-gray-800 mb-2">
            <%= music.title || '‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏û‡∏•‡∏á' %>
          </h2>
          <p class="text-gray-600">
            <%= music.description || '' %>
          </p>
        <% } else { %>
          <h2 class="text-lg sm:text-2xl font-semibold text-gray-800 mb-2">
            ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏•‡∏á
          </h2>
          <p class="text-gray-600">
            ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏•‡∏á‡πÑ‡∏î‡πâ
          </p>
        <% } %>
      </div>
    </div>
  </div>
</div>

<div class="container mx-auto px-4 py-8">
  <div class="max-w-2xl mx-auto text-center space-y-4">
    <% if (music && music.youtube_id) { %>
      <a href="https://youtu.be/<%= music.youtube_id %>" 
        target="_blank"
        class="inline-flex items-center px-8 py-4 bg-red-600 hover:bg-red-700 text-white font-bold rounded-full text-lg shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-300">
        <i class="fa-brands fa-youtube text-2xl mr-3"></i>
        ‡∏î‡∏π‡∏ö‡∏ô YouTube
      </a>
    <% } else { %>
      <p class="text-gray-500 text-lg">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏•‡∏¥‡∏á‡∏Å‡πå YouTube</p>
    <% } %>
  </div>
</div>

<div class="container mx-auto px-4 py-8">
  <div class="max-w-2xl mx-auto text-center">
    <div class="bg-white/80 backdrop-blur-sm rounded-2xl p-8 shadow-xl">
      <h2 class="text-3xl font-bold text-blue-800 mb-4">
        ‡∏®‡∏¥‡∏•‡∏õ‡∏¥‡∏ô
      </h2>
      <p class="text-lg text-blue-500 mb-6 font-semibold">
        <%= music ? (music.artist || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏®‡∏¥‡∏•‡∏õ‡∏¥‡∏ô') : '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏®‡∏¥‡∏•‡∏õ‡∏¥‡∏ô' %>
      </p>
      <div class="flex items-center justify-center space-x-4 text-blue-500">
        <span class="text-2xl">üé∂</span>
        <span class="text-2xl">üíô</span>
        <span class="text-2xl">üéµ</span>
      </div>
    </div>
  </div>
</div>

<div class="container mx-auto px-4 py-12">
  <div class="max-w-3xl mx-auto">
    <div class="bg-white/80 backdrop-blur-sm rounded-2xl shadow-2xl p-8">
      <div class="flex flex-col sm:flex-row items-center justify-between mb-6">
        <h2 class="text-2xl font-bold text-blue-800">
          üí¨ ‡πÅ‡∏™‡∏î‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏¥‡∏î‡πÄ‡∏´‡πá‡∏ô
        </h2>
        <button 
          id="add-comment-btn"
          type="button"
          class="mt-6 sm:mt-0 bg-gradient-to-r cursor-pointer from-blue-600 to-purple-500 hover:from-blue-700 hover:to-purple-600 text-white font-bold py-2 px-5 rounded-lg shadow-md transition-all duration-300 transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-blue-400 focus:ring-offset-2 focus:ring-offset-blue-50">
          ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏¥‡∏î‡πÄ‡∏´‡πá‡∏ô
        </button>
      </div>

      <!-- ‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≠‡∏°‡πÄ‡∏°‡∏ô‡∏ï‡πå -->
      <div class="mt-10 space-y-6 text-left">
        <% if (comments && comments.length > 0) { %>
          <% comments.forEach(comment => { %>
            <div class="bg-white/90 rounded-xl shadow-md p-5">
              <div class="flex items-center mb-2">
                <span class="text-sm font-semibold text-gray-500">
                  <%= new Date(comment.createdAt).toLocaleString("th-TH", { 
                    dateStyle: "short", 
                    timeStyle: "short" 
                  }) %>
                </span>
              </div>
              <p class="text-gray-700">
                <%= comment.content %>
              </p>
            </div>
          <% }) %>
        <% } else { %>
          <p class="text-gray-500 text-center">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏¥‡∏î‡πÄ‡∏´‡πá‡∏ô‡πÉ‡∏ô‡πÄ‡∏û‡∏•‡∏á‡∏ô‡∏µ‡πâ</p>
        <% } %>
      </div>
    </div>
  </div>
</div>

<script>
  document.getElementById("add-comment-btn").addEventListener("click", () => {
    Swal.fire({ 
      title: "üí¨ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏¥‡∏î‡πÄ‡∏´‡πá‡∏ô",
      html: `
        <form id="comment-form" class="space-y-4 text-left">
          <textarea 
            id="comment-textarea" 
            name="content" 
            rows="4" 
            placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏¥‡∏î‡πÄ‡∏´‡πá‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì..." 
            class="w-full rounded-lg border border-gray-300 p-3 focus:ring-2 focus:ring-blue-400 focus:outline-none text-gray-700"
            required
          ></textarea>
          <button 
            type="submit"
            class="w-full bg-gradient-to-r from-blue-600 to-purple-500 hover:from-blue-700 hover:to-purple-600 text-white font-bold py-3 rounded-lg shadow-md transition-all duration-300 transform hover:scale-105">
            ‡∏™‡πà‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏¥‡∏î‡πÄ‡∏´‡πá‡∏ô
          </button>
        </form>
      `,
      showCloseButton: true,
      allowOutsideClick: false,
      showConfirmButton: false,
      width: "40rem",
      background: "rgba(255,255,255,0.95)",
      backdrop: `
        rgba(0,0,0,0.4)
        left top
        no-repeat
      `,
      customClass: {
        popup: "rounded-2xl shadow-2xl",
        title: "text-2xl font-bold text-blue-800 mb-4",
      },
      didOpen: () => {
        const form = Swal.getHtmlContainer().querySelector("#comment-form");
        form.addEventListener("submit", (e) => {
          e.preventDefault();
          
          const content = form.content.value.trim();

          if (!content) {
            Swal.showValidationMessage("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏¥‡∏î‡πÄ‡∏´‡πá‡∏ô");
            return;
          }

          fetch(`/music/<%= music._id %>/comments`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ content })
          })
          .then(res => res.json())
          .then(() => {
            Swal.fire({
              icon: "success",
              title: "‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏¥‡∏î‡πÄ‡∏´‡πá‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢ üíú",
              confirmButtonColor: "#2563eb"
            }).then(() => {
              location.reload();
            });
          })
          .catch(() => {
            Swal.fire({
              icon: "error",
              title: "‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î",
              text: "‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏¥‡∏î‡πÄ‡∏´‡πá‡∏ô‡πÑ‡∏î‡πâ"
            });
          });
        });
      }
    });
  });
</script>